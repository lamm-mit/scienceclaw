#!/usr/bin/env bash
# ScienceClaw CLI Wrapper
# 
# Wraps openclaw command with ScienceClaw-specific settings:
# - Uses ~/.infinite/workspace as working directory
# - Sets INFINITE_API_BASE environment variable
# - Provides ScienceClaw-branded interface
#
# Usage: scienceclaw agent --message "Your message" --session-id session-name
#        scienceclaw --help

set -e

# ScienceClaw configuration
INFINITE_WORKSPACE="${HOME}/.infinite/workspace"
INFINITE_API_BASE="${INFINITE_API_BASE:-https://infinite-phi-one.vercel.app/api}"

# Colors for output
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if openclaw is installed
if ! command -v openclaw &> /dev/null; then
    echo -e "${YELLOW}âš ï¸  OpenClaw not found${NC}"
    echo "ScienceClaw requires OpenClaw runtime."
    echo ""
    echo "Install OpenClaw:"
    echo "  sudo npm install -g openclaw@latest"
    echo "  openclaw onboard --install-daemon"
    echo ""
    exit 1
fi

# Ensure workspace exists
if [ ! -d "$INFINITE_WORKSPACE" ]; then
    echo -e "${YELLOW}âš ï¸  Infinite workspace not found${NC}"
    echo "Creating workspace at: $INFINITE_WORKSPACE"
    mkdir -p "$INFINITE_WORKSPACE"/{skills,sessions,drafts,result}
fi

# Check for SOUL.md
if [ ! -f "$INFINITE_WORKSPACE/SOUL.md" ]; then
    echo -e "${YELLOW}âš ï¸  SOUL.md not found${NC}"
    echo "Run setup to create your agent:"
    echo "  cd /home/fiona/LAMM/scienceclaw"
    echo "  python3 setup.py"
    echo ""
fi

# Show ScienceClaw branding for help
if [ "$1" == "--help" ] || [ "$1" == "-h" ] || [ -z "$1" ]; then
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘                      ScienceClaw                          â•‘${NC}"
    echo -e "${CYAN}â•‘          Autonomous Science Agent Framework               â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "Platform: Infinite (https://infinite-phi-one.vercel.app)"
    echo "Workspace: $INFINITE_WORKSPACE"
    echo ""
    echo "Usage:"
    echo "  scienceclaw agent --message 'Your task' --session-id session-name"
    echo "  scienceclaw agent --help"
    echo ""
    echo "Examples:"
    echo "  # Biology research"
    echo "  scienceclaw agent --message 'Search PubMed for CRISPR delivery methods' --session-id crispr-research"
    echo ""
    echo "  # Chemistry research"
    echo "  scienceclaw agent --message 'Predict BBB penetration for aspirin' --session-id aspirin-admet"
    echo ""
    echo "  # Post to Infinite"
    echo "  scienceclaw agent --message 'Search PubMed for p53 mutations and post findings to Infinite chemistry community' --session-id p53-study"
    echo ""
    echo "This is a wrapper around OpenClaw. For OpenClaw-specific options:"
    echo "  openclaw --help"
    echo ""
    exit 0
fi

# Run openclaw from the Infinite workspace with environment variables set
cd "$INFINITE_WORKSPACE"
export INFINITE_API_BASE="$INFINITE_API_BASE"

echo -e "${GREEN}ğŸ”¬ ScienceClaw${NC} - Running from $INFINITE_WORKSPACE"
echo -e "${GREEN}ğŸŒ Platform:${NC} Infinite ($INFINITE_API_BASE)"
echo ""

# Pass all arguments to openclaw
openclaw "$@"
